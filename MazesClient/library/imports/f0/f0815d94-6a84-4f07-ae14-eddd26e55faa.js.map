{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\GameLogic/assets\\Script\\GameLogic\\GameApplication.js"],"names":["Player","require","SoundManager","DataAnalytics","MainView","LevelView","cc","Class","extends","Component","properties","soundManager","default","type","missions","missionsCB","conf","confCB","_playTimes","Integer","playTimes","get","set","val","playTimesAD","console","log","SDK","showInterstitialAd","isCompleted","gameApplication","doEvent","PopGameView","Node","start","i18n","init","login","getInfo","id","levelDetail","level","levelBegin","bind","getConf","path","cb","loader","loadRes","err","results","onLoad","window","gameFirst","game","addPersistRootNode","node","gameTimes","manager","director","getCollisionManager","enabled","enabledDebugDraw","enabledDrawBoundingBox","invokeMissionCB","openMainView","getScore","mid","undefined","lid","bid","loadScene","on","EVENT_HIDE","gameHideAndShow","audioEngine","pauseAll","EVENT_SHOW","resumeAll","onDestroy","levelResult","logout","length","push","self","forEach","nodePath","active","find","setNodeActive","getComponent","event","switchGameAsync"],"mappings":";;;;;;;;;;AAAA,IAAIA,SAASC,QAAQ,qBAAR,CAAb;AACA,IAAIC,eAAeD,QAAQ,2BAAR,CAAnB;AACA,IAAIE,gBAAgBF,QAAQ,sBAAR,CAApB;AACA,IAAIG,WAAWH,QAAQ,gBAAR,CAAf;AACA,IAAII,YAAYJ,QAAQ,iBAAR,CAAhB;;AAEAK,GAAGC,KAAH;AACIC,aAASF,GAAGG,SADhB;;AAGIC,gBAAY;AACRC,sBAAc;AACVC,qBAAS,IADC;AAEVC,kBAAMX;AAFI,SADN;AAKR;AACA;AACA;AACA;AACAY,kBAAU;AACNF,qBAAS;AADH,SATF;AAYRG,oBAAY;AACRH,qBAAS;AADD,SAZJ;AAeRI,cAAM;AACFJ,qBAAS;AADP,SAfE;AAkBRK,gBAAQ;AACJL,qBAAS;AADL,SAlBA;AAqBRM,oBAAY;AACRN,qBAAS,CADD;AAERC,kBAAMP,GAAGa;AAFD,SArBJ;AAyBRC,mBAAW;AACPC,iBAAK,eAAY;AACb,uBAAO,KAAKH,UAAZ;AACH,aAHM;AAIPI,iBAAK,aAAUC,GAAV,EAAe;AAChB,qBAAKL,UAAL,GAAkBK,GAAlB;;AAEA,oBAAI,KAAKL,UAAL,GAAkBM,WAAlB,IAAiC,CAAjC,IAAsC,KAAKN,UAAL,IAAmB,CAA7D,EAAgE;AAC5DO,4BAAQC,GAAR,CAAY,QAAZ;AACAC,0BAAMC,kBAAN,CAAyB,UAAUC,WAAV,EAAuB;AAC5C,4BAAIA,WAAJ,EAAiB;AACbC,4CAAgB3B,aAAhB,CAA8B4B,OAA9B,CAAsC,UAAtC;AACH,yBAFD,MAEO;AACHD,4CAAgB3B,aAAhB,CAA8B4B,OAA9B,CAAsC,UAAtC;AACH;AACDN,gCAAQC,GAAR,CAAY,QAAZ;AACH,qBAPD;AAQH;AACJ;AAlBM,SAzBH;AA6CRM,qBAAY;AACRpB,qBAAS,IADD;AAERC,kBAAMP,GAAG2B;AAFD;AA7CJ,KAHhB;;AAsDIC,SAtDJ,mBAsDY;AACJ,YAAMC,OAAOlC,QAAQ,cAAR,CAAb;AACAkC,aAAKC,IAAL,CAAU,IAAV;AACAT,cAAMS,IAAN,CAAW,YAAY;AACnBjC,0BAAckC,KAAd,CAAoBV,MAAMW,OAAN,GAAgBC,EAApC;AACA,gBAAIC,cAAc,EAAlB;AACAA,wBAAYC,KAAZ,GAAoB,WAApB;AACAX,4BAAgB3B,aAAhB,CAA8BuC,UAA9B,CAAyCF,WAAzC;AACH,SALU,CAKTG,IALS,CAKJ,IALI,CAAX;AAMH,KA/DL;AAiEIC,WAjEJ,mBAiEYC,IAjEZ,EAiEkBC,EAjElB,EAiEsB;;AAEd,YAAI,KAAK9B,IAAL,CAAU6B,IAAV,KAAmB,IAAvB,EAA6B;AACzB,gBAAIC,EAAJ,EAAQ;AACJ;AACAA,mBAAG,KAAK9B,IAAL,CAAU6B,IAAV,CAAH;AACH;AACJ,SALD,MAKO;AACH;AACAvC,eAAGyC,MAAH,CAAUC,OAAV,CAAkBH,IAAlB,EAAwB,UAAUI,GAAV,EAAeC,OAAf,EAAwB;AAC5C,qBAAKlC,IAAL,CAAU6B,IAAV,IAAkBK,OAAlB;AACA,oBAAIJ,MAAM,IAAV,EAAgB;AACZA,uBAAGI,OAAH;AACH;AACJ,aALuB,CAKtBP,IALsB,CAKjB,IALiB,CAAxB;AAMH;AACJ,KAjFL;AAoFIQ,UApFJ,oBAoFa;AACLC,eAAOtB,eAAP,GAAyB,IAAzB;AACAsB,eAAOC,SAAP,GAAmB,IAAnB;AACA,aAAKlD,aAAL,GAAqBA,aAArB;AACAA,sBAAciC,IAAd;AACA9B,WAAGgD,IAAH,CAAQC,kBAAR,CAA2B,KAAKC,IAAhC;AACAJ,eAAOK,SAAP,GAAmB,CAAnB;AACA;AACA,YAAIC,UAAUpD,GAAGqD,QAAH,CAAYC,mBAAZ,EAAd;AACAF,gBAAQG,OAAR,GAAkB,IAAlB;AACAH,gBAAQI,gBAAR,GAA2B,KAA3B;AACAJ,gBAAQK,sBAAR,GAAiC,KAAjC;;AAEA;AACAzD,WAAGyC,MAAH,CAAUC,OAAV,CAAkB,eAAlB,EAAmC,UAAUC,GAAV,EAAeC,OAAf,EAAwB;AACvD,iBAAKpC,QAAL,GAAgBoC,OAAhB;AACA,iBAAKc,eAAL;AACH,SAHkC,CAGjCrB,IAHiC,CAG5B,IAH4B,CAAnC;;AAKA,aAAKsB,YAAL;;AAEA;AACAtC,cAAMuC,QAAN,CAAe,YAAf,EAA6B,UAAUC,GAAV,EAAe;AACxC,gBAAIA,OAAO,CAAP,IAAYA,OAAOC,SAAnB,IAAgCD,OAAO,IAA3C,EAAiD;AAC7CA,sBAAM,CAAN;AACH;AACDxC,kBAAMuC,QAAN,CAAe,YAAf,EAA6B,UAAUG,GAAV,EAAe;AACxC,oBAAIA,OAAO,CAAP,IAAYA,OAAOD,SAAnB,IAAgCC,OAAO,IAA3C,EAAiD;AAC7CA,0BAAM,CAAN;AACH;AACDjB,uBAAOkB,GAAP,GAAa,CAAb;AACAlB,uBAAOe,GAAP,GAAaA,GAAb;AACAf,uBAAOiB,GAAP,GAAaA,GAAb;AACA/D,mBAAGqD,QAAH,CAAYY,SAAZ,CAAsB,MAAtB;AACH,aAR4B,CAQ3B5B,IAR2B,CAQtB,IARsB,CAA7B;AASH,SAb4B,CAa3BA,IAb2B,CAatB,IAbsB,CAA7B;AAcA;AACA;AACA;AACA;;AAEArC,WAAGgD,IAAH,CAAQkB,EAAR,CAAWlE,GAAGgD,IAAH,CAAQmB,UAAnB,EAA+B,YAAY;AACvCtE,0BAAcuE,eAAd,CAA8B,IAA9B;AACApE,eAAGqE,WAAH,CAAeC,QAAf;AACH,SAHD;;AAKAtE,WAAGgD,IAAH,CAAQkB,EAAR,CAAWlE,GAAGgD,IAAH,CAAQuB,UAAnB,EAA+B,YAAY;AACvC1E,0BAAcuE,eAAd,CAA8B,KAA9B;AACApE,eAAGqE,WAAH,CAAeG,SAAf;AACH,SAHD;AAIH,KAtIL;AAwIIC,aAxIJ,uBAwIgB;AACR,YAAIvC,cAAc,EAAlB;AACAA,oBAAYC,KAAZ,GAAoB,WAApB;AACAX,wBAAgB3B,aAAhB,CAA8B6E,WAA9B,CAA0C,IAA1C,EAAgDxC,WAAhD;AACArC,sBAAc8E,MAAd,CAAqBtD,MAAMW,OAAN,GAAgBC,EAArC;AACH;AA7IL,gEA+IgB;AACRjC,OAAGqD,QAAH,CAAYC,mBAAZ,GAAkCC,OAAlC,GAA4C,KAA5C;AACH,CAjJL,kEAmJgBf,EAnJhB,EAmJoB;;AAEZ,QAAI,KAAKhC,QAAL,IAAiB,IAAjB,IAAyB,KAAKA,QAAL,CAAcoE,MAAd,GAAuB,CAApD,EAAuD;AACnDpC,WAAG,KAAKhC,QAAR;AACH,KAFD,MAEO;AACH,aAAKC,UAAL,CAAgBoE,IAAhB,CAAqBrC,EAArB;AACH;AACJ,CA1JL,4EA4JsB;AACd,QAAIsC,OAAO,IAAX;AACA,QAAI,KAAKrE,UAAL,CAAgBmE,MAAhB,GAAyB,CAA7B,EAAgC;AAC5B,aAAKnE,UAAL,CAAgBsE,OAAhB,CAAwB,UAAUvC,EAAV,EAAc;AAClC,gBAAIA,MAAM,IAAV,EAAgB;AACZA,mBAAGsC,KAAKtE,QAAR;AACH;AACJ,SAJD;AAKH;AACJ,CArKL,sEAuKkBwE,QAvKlB,EAuK4BC,MAvK5B,EAuKoC;AAC5BjF,OAAGkF,IAAH,CAAQ,YAAYF,QAApB,EAA8BC,MAA9B,GAAuCA,MAAvC;AACH,CAzKL,8CA4KkB,wBAAY;AACtB,SAAKE,aAAL,CAAmB,WAAnB,EAAgC,KAAhC;AACA,SAAKA,aAAL,CAAmB,UAAnB,EAA+B,IAA/B;AACH,CA/KL,+CAiLmB,uBAAUnB,GAAV,EAAeH,GAAf,EAAoB;AAC/B,SAAKsB,aAAL,CAAmB,WAAnB,EAAgC,IAAhC;AACA,SAAKA,aAAL,CAAmB,UAAnB,EAA+B,KAA/B;AACAnF,OAAGkF,IAAH,CAAQ,kBAAR,EAA4BE,YAA5B,CAAyC,WAAzC,EAAsDtD,IAAtD,CAA2DkC,GAA3D,EAAgEH,GAAhE;AACH,CArLL,gDAuLoB,0BAAY;AACxB;AACH,CAzLL,4DA4LawB,KA5Lb,EA4LmB9E,IA5LnB,EA4LwB;AAChBc,UAAMiE,eAAN,CAAsB/E,IAAtB;AACH,CA9LL","file":"GameApplication.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\GameLogic","sourcesContent":["var Player = require(\"../GameLogic/Player\");\r\nvar SoundManager = require(\"../GameLogic/SoundManager\");\r\nvar DataAnalytics = require(\"../SDK/DataAnalytics\");\r\nvar MainView = require(\"../UI/MainView\");\r\nvar LevelView = require(\"../UI/LevelView\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        soundManager: {\r\n            default: null,\r\n            type: SoundManager,\r\n        },\r\n        // audioSource: {\r\n        //      type: cc.AudioSource,\r\n        //      default: null\r\n        // },\r\n        missions: {\r\n            default: []\r\n        },\r\n        missionsCB: {\r\n            default: []\r\n        },\r\n        conf: {\r\n            default: {},\r\n        },\r\n        confCB: {\r\n            default: []\r\n        },\r\n        _playTimes: {\r\n            default: 0,\r\n            type: cc.Integer,\r\n        },\r\n        playTimes: {\r\n            get: function () {\r\n                return this._playTimes;\r\n            },\r\n            set: function (val) {\r\n                this._playTimes = val;\r\n\r\n                if (this._playTimes % playTimesAD == 0 && this._playTimes != 1) {\r\n                    console.log(\"播放插屏广告\");\r\n                    SDK().showInterstitialAd(function (isCompleted) {\r\n                        if (isCompleted) {\r\n                            gameApplication.DataAnalytics.doEvent(\"播放插屏广告成功\");\r\n                        } else {\r\n                            gameApplication.DataAnalytics.doEvent(\"播放插屏广告失败\");\r\n                        }\r\n                        console.log(\"播放Done\");\r\n                    });\r\n                }\r\n            },\r\n        },\r\n        PopGameView:{\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n    },\r\n\r\n    start() {\r\n        const i18n = require('LanguageData');\r\n        i18n.init('en');\r\n        SDK().init(function () {\r\n            DataAnalytics.login(SDK().getInfo().id);\r\n            var levelDetail = {};\r\n            levelDetail.level = \"gameStart\"\r\n            gameApplication.DataAnalytics.levelBegin(levelDetail);\r\n        }.bind(this));\r\n    },\r\n\r\n    getConf(path, cb) {\r\n\r\n        if (this.conf[path] != null) {\r\n            if (cb) {\r\n                // cc.log(\"从cache读取：\"+path)\r\n                cb(this.conf[path]);\r\n            }\r\n        } else {\r\n            // cc.log(\"从硬盘读取：\"+path)\r\n            cc.loader.loadRes(path, function (err, results) {\r\n                this.conf[path] = results;\r\n                if (cb != null) {\r\n                    cb(results)\r\n                }\r\n            }.bind(this));\r\n        }\r\n    },\r\n\r\n\r\n    onLoad() {\r\n        window.gameApplication = this;\r\n        window.gameFirst = true;\r\n        this.DataAnalytics = DataAnalytics;\r\n        DataAnalytics.init()\r\n        cc.game.addPersistRootNode(this.node);\r\n        window.gameTimes = 1;\r\n        // this.audioSource.play();\r\n        var manager = cc.director.getCollisionManager();\r\n        manager.enabled = true;\r\n        manager.enabledDebugDraw = false;\r\n        manager.enabledDrawBoundingBox = false;\r\n\r\n        //Load Json\r\n        cc.loader.loadRes(\"conf/missions\", function (err, results) {\r\n            this.missions = results;\r\n            this.invokeMissionCB();\r\n        }.bind(this));\r\n\r\n        this.openMainView();\r\n\r\n        //处理第一次进入游戏\r\n        SDK().getScore(\"playingMid\", function (mid) {\r\n            if (mid == 0 || mid == undefined || mid == null) {\r\n                mid = 1;\r\n            }\r\n            SDK().getScore(\"playingLid\", function (lid) {\r\n                if (lid == 0 || lid == undefined || lid == null) {\r\n                    lid = 1;\r\n                }\r\n                window.bid = 1;\r\n                window.mid = mid;\r\n                window.lid = lid;\r\n                cc.director.loadScene(\"game\"); \r\n            }.bind(this));\r\n        }.bind(this));\r\n        // window.bid = 1;\r\n        // window.mid = 1;\r\n        // window.lid = 8;\r\n        // cc.director.loadScene(\"game\"); \r\n\r\n        cc.game.on(cc.game.EVENT_HIDE, function () {\r\n            DataAnalytics.gameHideAndShow(true);\r\n            cc.audioEngine.pauseAll();\r\n        });\r\n\r\n        cc.game.on(cc.game.EVENT_SHOW, function () {\r\n            DataAnalytics.gameHideAndShow(false);\r\n            cc.audioEngine.resumeAll();\r\n        });\r\n    },\r\n\r\n    onDestroy() {\r\n        var levelDetail = {};\r\n        levelDetail.level = \"gameStart\"\r\n        gameApplication.DataAnalytics.levelResult(true, levelDetail);\r\n        DataAnalytics.logout(SDK().getInfo().id);\r\n    },\r\n\r\n    onDestroy() {\r\n        cc.director.getCollisionManager().enabled = false;\r\n    },\r\n\r\n    getMissions(cb) {\r\n\r\n        if (this.missions != null && this.missions.length > 0) {\r\n            cb(this.missions);\r\n        } else {\r\n            this.missionsCB.push(cb);\r\n        }\r\n    },\r\n\r\n    invokeMissionCB() {\r\n        var self = this;\r\n        if (this.missionsCB.length > 0) {\r\n            this.missionsCB.forEach(function (cb) {\r\n                if (cb != null) {\r\n                    cb(self.missions);\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    setNodeActive(nodePath, active) {\r\n        cc.find(\"Canvas/\" + nodePath).active = active;\r\n    },\r\n\r\n\r\n    openMainView: function () {\r\n        this.setNodeActive(\"levelView\", false);\r\n        this.setNodeActive(\"mainView\", true);\r\n    },\r\n\r\n    openLevelView: function (bid, mid) {\r\n        this.setNodeActive(\"levelView\", true);\r\n        this.setNodeActive(\"mainView\", false);\r\n        cc.find(\"Canvas/levelView\").getComponent(\"LevelView\").init(bid, mid);\r\n    },\r\n\r\n    onQuitBtnClick: function () {\r\n        // console.log(\"用户中途退出\");\r\n    },\r\n\r\n    //互推按钮时间\r\n    popClick(event,type){\r\n        SDK().switchGameAsync(type);\r\n    },\r\n    // update (dt) {},\r\n});\r\n"]}