{"version":3,"sources":["facebook.js"],"names":["Utils","require","ELoadState","AD_LOADING","AD_LOAD_SUCCESS","AD_LOAD_FAIL","AD_COMPLETE","GM_PIDS","video_ad_ids","interstitial_ad_ids","FB_SDK","cb","videoAd","videoAdState","InterstitialAd","InterstitialAdState","MyPlayer","prototype","init","FBInstant","loadVideoAd","loadInterstitialAd","locale","getLocale","i18n","name","player","getName","cc","loader","load","getPhoto","err","texture","head","SpriteFrame","id","getID","isGM","playerID","inArray","clearData","SDK","setScore","all","my_help","bid","mid","lid","param","param1","param2","param3","share","score","self","context","chooseAsync","then","doShare","catch","e","code","en_text","cn_text","framePath","loadRes","Texture2D","canvas","document","createElement","ctx","getContext","width","height","image","getHtmlElementObj","drawImage","base64Picture","toDataURL","updateAsync","action","cta","template","text","data","myReplayData","strategy","notification","getInterstitialAdAsync","interstitial","loadAsync","bind","switchGameAsync","game_id","showInterstitialAd","showAsync","getRewardedVideoAsync","rewardedVideo","hasVideoAd","showVideoAd","game","pause","resume","getInfo","getScore","key","node","JSON","parse","sys","localStorage","getItem","parseInt","datas","push","getDataAsync","p","setItem","setDataAsync","module","exports","instance"],"mappings":"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","file":"facebook.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\SDK","sourcesContent":["var Utils = require(\"../Utils/Utils\");\r\n\r\nvar ELoadState = {\r\n    AD_LOADING: \"AD_LOADING\",\r\n    AD_LOAD_SUCCESS: \"AD_LOAD_SUCCESS\",\r\n    AD_LOAD_FAIL: \"AD_LOAD_FAIL\",\r\n    AD_COMPLETE: \"AD_COMPLETE\"\r\n};\r\n\r\nvar GM_PIDS = [1609486632505587, 1759127554126047];\r\nvar video_ad_ids = '160840521263423_160841467929995';\r\nvar interstitial_ad_ids = '160840521263423_160841827929959';\r\n\r\nvar FB_SDK = function () {\r\n    this.cb = null;\r\n    this.videoAd = null;\r\n    this.videoAdState = null;\r\n    this.InterstitialAd = null;\r\n    this.InterstitialAdState = null;\r\n};\r\n\r\nvar MyPlayer = {}\r\n\r\n\r\n/**\r\n    初始化AD等\r\n*/\r\nFB_SDK.prototype.init = function (cb) {\r\n    if (typeof FBInstant === 'undefined') return;\r\n    // console.log(\"playerID\",FBInstant.player.getID());\r\n\r\n    this.loadVideoAd();\r\n    this.loadInterstitialAd();\r\n\r\n    var locale = FBInstant.getLocale(); // 'en_US'\r\n    if (locale == 'zh_CN') {\r\n        const i18n = require('LanguageData');\r\n        i18n.init('en');\r\n    }\r\n\r\n    MyPlayer.name = FBInstant.player.getName();\r\n    cc.loader.load(FBInstant.player.getPhoto(), function (err, texture) {\r\n        MyPlayer.head = new cc.SpriteFrame(texture);\r\n    });\r\n    MyPlayer.id = FBInstant.player.getID();\r\n\r\n    var locale = this.getLocale(); // 'en_US'\r\n    /* FBInstant.startGameAsync().then(function () {\r\n\r\n    }); */\r\n\r\n    if (cb != null) {\r\n        cb()\r\n    }\r\n};\r\n\r\nFB_SDK.prototype.isGM = function () {\r\n    if (typeof FBInstant === 'undefined') return false;\r\n\r\n    var playerID = FBInstant.player.getID();\r\n    // console.log(\"Utils.inArray(playerID,GM_PIDS):\",Utils.inArray(playerID,GM_PIDS))\r\n    return Utils.inArray(playerID, GM_PIDS);\r\n};\r\n\r\nFB_SDK.prototype.clearData = function () {\r\n    if (typeof FBInstant === 'undefined') return false;\r\n\r\n    SDK().setScore({ all: 0 }, null);\r\n    SDK().setScore({ my_help: 0 }, null);\r\n    var bid = 1;\r\n    for (var mid = 1; mid <= 6; mid++) {\r\n        for (var lid = 1; lid <= 100; lid++) {\r\n            var param = {};\r\n            param[bid + \"_\" + mid + \"_\" + lid] = 0;\r\n            this.setScore(param, null);\r\n\r\n            var param1 = {};\r\n            param1[bid + \"_\" + mid + \"_\" + lid + \"_moves\"] = 0;\r\n            this.setScore(param1, null);\r\n        }\r\n\r\n        var param2 = {};\r\n        param2[bid + \"_\" + mid] = 0;\r\n        this.setScore(param2, null);\r\n\r\n        var param3 = {};\r\n        param3[\"unlock_\" + bid + \"_\" + mid] = 0;\r\n        SDK().setScore(param3, null);\r\n    }\r\n};\r\n\r\nFB_SDK.prototype.getLocale = function () {\r\n    if (typeof FBInstant === 'undefined') return;\r\n\r\n    return FBInstant.getLocale();\r\n};\r\n\r\nFB_SDK.prototype.share = function (score, cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        if (cb != null) {\r\n            cb(true);\r\n        }\r\n        return;\r\n    }\r\n    var self = this;\r\n\r\n    FBInstant.context\r\n        .chooseAsync()\r\n        .then(function () {\r\n            // console.log(\"FBInstant.context.getID():\",FBInstant.context.getID());\r\n            self.doShare(score);\r\n            if (cb != null) {\r\n                cb(true);\r\n            }\r\n        }\r\n        ).catch(function (e) {\r\n            // console.log(\"catch\",e);\r\n            if (e.code != null && e.code == \"SAME_CONTEXT\") {\r\n                //相同的用户或group，不能再次发消息\r\n                if (cb != null) {\r\n                    cb(false);\r\n                }\r\n            }\r\n        });\r\n};\r\n\r\nFB_SDK.prototype.doShare = function (score) {\r\n    var self = this;\r\n    var en_text = self.getName() + \" finish \" + score + \" missions,Can you beat me?\";\r\n    var cn_text = self.getName() + \"向你发起挑战！他已过了 \" + score + \" 关！\";\r\n    // console.log(\"share:\"+en_text);\r\n\r\n    var framePath = \"texture2d/game_icon\";\r\n    // console.log(\"framePath:\",framePath)\r\n    cc.loader.loadRes(framePath, cc.Texture2D, function (err, texture) {\r\n        let canvas = document.createElement('canvas');\r\n        let ctx = canvas.getContext('2d');\r\n        canvas.width = 600;\r\n        canvas.height = 420;\r\n\r\n        let image = texture.getHtmlElementObj();\r\n        ctx.drawImage(image, 0, 0);\r\n\r\n        var base64Picture = canvas.toDataURL('image/png');\r\n\r\n        FBInstant.updateAsync({\r\n            action: 'CUSTOM',\r\n            cta: 'Play Game',\r\n            template: 'join_fight',\r\n            image: base64Picture,\r\n            text: en_text,\r\n            data: { myReplayData: '...' },\r\n            strategy: 'IMMEDIATE',\r\n            notification: 'NO_PUSH',\r\n        }).then(function () {\r\n            //当消息发送后\r\n            // console.log(\"____当消息发送后\")\r\n        });\r\n    });\r\n};\r\n\r\n\r\nFB_SDK.prototype.loadInterstitialAd = function () {\r\n    if (typeof FBInstant === 'undefined') return;\r\n\r\n    // console.log(\"loadInterstitialAd\")\r\n    FBInstant.getInterstitialAdAsync(\r\n        interstitial_ad_ids,\r\n    ).then(function (interstitial) {\r\n        // console.log(\"FBInstant.getInterstitialAdAsync:\",interstitial);\r\n        this.InterstitialAd = interstitial;\r\n        this.InterstitialAdState = ELoadState.AD_LOADING;\r\n        return this.InterstitialAd.loadAsync();\r\n    }.bind(this)).catch(function (e) {\r\n        // console.log(\"load.showInterstitialAd catch\");\r\n        // console.log(JSON.stringify(e));\r\n    }.bind(this))\r\n        .then(function () {\r\n            // console.log(\"FBInstant.getInterstitialAdAsync done:\");\r\n            this.InterstitialAdState = ELoadState.AD_LOAD_SUCCESS;\r\n        }.bind(this));\r\n};\r\n\r\n/**\r\n * 切换到别的游戏（互推游戏）\r\n**/\r\nFB_SDK.prototype.switchGameAsync = function(game_id) {\r\n    if (typeof FBInstant === 'undefined') return false;\r\n    FBInstant.switchGameAsync(game_id).catch(function (e) {\r\n          // Handle game change failure\r\n    });\r\n};\r\n\r\n\r\nFB_SDK.prototype.showInterstitialAd = function (cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        if (cb) {\r\n            cb(false);\r\n        }\r\n        return;\r\n    };\r\n\r\n    // console.log(\"FB_SDK.prototype.showInterstitialAd\",this.InterstitialAd);\r\n\r\n    if (this.InterstitialAd != null) {\r\n        // console.log(\"show Interstitial ad start\");\r\n        this.InterstitialAd.showAsync().then(function () {\r\n            // console.log(\"this.showInterstitialAd.showAsync\");\r\n            this.InterstitialAdState = ELoadState.AD_COMPLETE;\r\n            // this.game.paused = false;\r\n            // window.sounds.toggleMusic(false);\r\n            if (cb) {\r\n                cb(true);\r\n            }\r\n\r\n            // console.log(\"show showInterstitialAd success\");\r\n            this.loadInterstitialAd();\r\n        }.bind(this))\r\n            .catch(function (e) {\r\n                // console.log(\"this.showInterstitialAd catch\");\r\n                this.InterstitialAdState = ELoadState.AD_COMPLETE;\r\n                // this.game.paused = false;\r\n                // window.sounds.toggleMusic(false);\r\n                // console.log(JSON.stringify(e));\r\n                if (cb) {\r\n                    cb(false);\r\n                }\r\n            }.bind(this));\r\n    } else {\r\n        // console.log(\"show showInterstitialAd ad Stop\");\r\n        if (cb) {\r\n            cb(false);\r\n        }\r\n        this.loadInterstitialAd();\r\n    }\r\n};\r\n\r\nFB_SDK.prototype.loadVideoAd = function () {\r\n    if (typeof FBInstant === 'undefined') return;\r\n\r\n    // console.log(\"FB_SDK.prototype.loadVideoAd\");\r\n    FBInstant.getRewardedVideoAsync(\r\n        video_ad_ids,\r\n    ).then(function (rewardedVideo) {\r\n        this.videoAd = rewardedVideo;\r\n        this.videoAdState = ELoadState.AD_LOADING;\r\n        return this.videoAd.loadAsync();\r\n    }.bind(this)).then(function () {\r\n        this.videoAdState = ELoadState.AD_LOAD_SUCCESS;\r\n    }.bind(this)).catch(function (err) {\r\n        this.videoAdState = ELoadState.AD_LOADING;\r\n        this.loadVideoAd();\r\n    }.bind(this));;\r\n};\r\n\r\nFB_SDK.prototype.hasVideoAd = function () {\r\n    if (typeof FBInstant === 'undefined') {\r\n        return false;\r\n    };\r\n\r\n    return this.videoAd != null;\r\n};\r\n\r\nFB_SDK.prototype.showVideoAd = function (cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        if (cb) {\r\n            cb(true);\r\n        }\r\n        return;\r\n    };\r\n\r\n    // console.log(\"FB_SDK.prototype.showVideoAd\",this.videoAd);\r\n\r\n    if (this.videoAd != null) {\r\n        cc.game.pause();\r\n        // console.log(\"show video ad start\");\r\n        this.videoAd.showAsync().then(function () {\r\n            // console.log(\"this.videoAd.showAsync\");\r\n            this.videoAdState = ELoadState.AD_COMPLETE;\r\n            // this.game.paused = false;\r\n            // window.sounds.toggleMusic(false);\r\n            if (cb) {\r\n                cb(true);\r\n            }\r\n            cc.game.resume();\r\n            // console.log(\"show video ad success\");\r\n            this.loadVideoAd();\r\n        }.bind(this))\r\n            .catch(function (e) {\r\n                // console.log(\"this.videoAd catch\");\r\n                this.videoAdState = ELoadState.AD_COMPLETE;\r\n                // this.game.paused = false;\r\n                // window.sounds.toggleMusic(false);\r\n                // console.log(JSON.stringify(e));\r\n                if (cb) {\r\n                    cb(false);\r\n                }\r\n                cc.game.resume();\r\n            }.bind(this));\r\n    } else {\r\n        // console.log(\"show video ad Stop\");\r\n        if (cb) {\r\n            cb(false);\r\n        }\r\n        cc.game.resume();\r\n        this.loadVideoAd();\r\n    }\r\n};\r\n\r\nFB_SDK.prototype.getInfo = function () {\r\n    if (typeof FBInstant === 'undefined') {\r\n        return { id: 1 };\r\n    }\r\n    return MyPlayer;\r\n};\r\n\r\nFB_SDK.prototype.getName = function () {\r\n    if (typeof FBInstant === 'undefined') return \"undefined\";\r\n    return FBInstant.player.getName();\r\n};\r\n\r\nFB_SDK.prototype.getScore = function (key, cb, node, lid) {\r\n    if (typeof FBInstant === 'undefined') {\r\n        var score = JSON.parse(cc.sys.localStorage.getItem(key));\r\n        if (typeof score === 'undefined' || score == null) {\r\n            score = 0;\r\n        } else {\r\n            score = parseInt(score);\r\n        }\r\n        cb(score, node, lid);\r\n    } else {\r\n        var datas = [];\r\n        datas.push(key);\r\n        var score = 0;\r\n        FBInstant.player\r\n            .getDataAsync(datas)\r\n            .then(function (data) {\r\n                // console.log('data is loaded',key,data['key']);\r\n                if (typeof data[key] === 'undefined') {\r\n                    score = 0;\r\n                } else {\r\n                    score = parseInt(data[key]);\r\n                }\r\n                // console.log(\"--------------FB_SDK.prototype.getScore:\",score)\r\n                cb(score, node, lid);\r\n            });\r\n    }\r\n};\r\n\r\nFB_SDK.prototype.setScore = function (score, cb) {\r\n    if (typeof FBInstant === 'undefined') {\r\n\r\n        for (var p in score) {//遍历json对象的每个key/value对,p为key\r\n            // cc.log(\"setScore:\"+ p + \"_\" + score[p]);\r\n            cc.sys.localStorage.setItem(p, score[p]);\r\n        }\r\n        // \r\n        if (cb != null) {\r\n            cb();\r\n        }\r\n    } else {\r\n        FBInstant.player\r\n            .setDataAsync(score)\r\n            .then(function () {\r\n                if (cb != null) {\r\n                    cb();\r\n                }\r\n                // console.log('------------data is set',score);\r\n            });\r\n    }\r\n};\r\n\r\nmodule.exports = (function () {\r\n    var instance;\r\n    return function () {\r\n        if (!instance) {\r\n            instance = new FB_SDK();\r\n        }\r\n        return instance;\r\n    }\r\n})();\r\n\r\n\r\n"]}